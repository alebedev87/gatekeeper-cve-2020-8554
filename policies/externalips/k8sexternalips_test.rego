package k8sexternalips

test_service_create_allowed {
    count(violation) == 0 with input as serviceCreate({}, [])
}

test_service_create_with_whitelist_allowed {
    count(violation) == 0 with input as serviceCreate({"allowedIPs":["203.0.113.0"]}, ["203.0.113.0"])
}

test_service_create_deny {
    violation == {{"msg": "service has forbidden external IPs: {\"8.8.8.8\"}"}} with input as serviceCreate({}, ["8.8.8.8"])
}

test_service_create_with_whitelist_deny {
    violation == {{"msg": "service has forbidden external IPs: {\"8.8.8.8\"}"}} with input as serviceCreate({"allowedIPs":["203.0.113.0"]}, ["8.8.8.8"])
}

test_service_update_allowed {
    count(violation) == 0 with input as serviceUpdate({}, [], [])
}

test_service_update_with_whitelist_allowed {
    count(violation) == 0 with input as serviceUpdate({"allowedIPs":["203.0.113.0"]}, ["203.0.113.0"], [])
}

test_service_update_deny {
    violation == {{"msg": "service has forbidden external IPs: {\"8.8.8.8\"}"}} with input as serviceUpdate({}, ["8.8.8.8"], [])
}

test_service_update_with_whitelist_deny {
    violation == {{"msg": "service has forbidden external IPs: {\"1.1.1.1\"}"}} with input as serviceUpdate({"allowedIPs":["203.0.113.0"]}, ["203.0.113.0", "1.1.1.1"], ["203.0.113.0"])
}
