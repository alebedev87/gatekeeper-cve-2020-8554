package k8sexternalips

serviceCreate(parameters, externalIPs) = output {
    output = {
        "parameters" : parameters,
        "kind": "AdmissionReview",
        "apiVersion": "admission.k8s.io/v1beta1",
        "review": {
            "kind": {
                "group": "",
                "version": "v1",
                "kind": "Service"
            },
            "resource": {
                "group": "",
                "version": "v1",
                "resource": "services"
            },
            "requestKind": {
                "group": "",
                "version": "v1",
                "kind": "Service"
            },
            "requestResource": {
                "group": "",
                "version": "v1",
                "resource": "services"
            },
            "name": "testsvc",
            "operation": "CREATE",
            "userInfo": {
                "username": "minikube-user",
                "groups": [
                    "system:masters",
                    "system:authenticated"
                ]
            },
            "object": {
                "apiVersion": "v1",
                "kind": "Service",
                "metadata": {
                    "creationTimestamp": "2021-01-05T14:24:26Z",
                    "name": "testsvc",
                    "resourceVersion": "30281949",
                    "selfLink": "/api/v1/namespaces/cnb/services/testsvc",
                    "uid": "fbc8af61-e656-49d2-a996-10360ab6bdd5"
                },
                "spec": {
                    "clusterIP": "172.30.191.161",
                    "externalIPs": externalIPs,
                    "ports": [
                        {
                            "name": "http",
                            "port": 80,
                            "protocol": "TCP",
                            "targetPort": 8080
                        }
                    ],
                    "selector": {
                        "app": "myapp"
                    },
                    "sessionAffinity": "None",
                    "type": "ClusterIP"
                },
                "status": {
                    "loadBalancer": {}
                }
            },
            "oldObject": null,
            "dryRun": false,
            "options": {
                "kind": "CreateOptions",
                "apiVersion": "meta.k8s.io/v1"
            }
        }
    }
}

serviceUpdate(parameters, externalIPs, oldExternalIPs) = output {
    output = {
        "parameters" : parameters,
        "kind": "AdmissionReview",
        "apiVersion": "admission.k8s.io/v1beta1",
        "review": {
            "kind": {
                "group": "",
                "version": "v1",
                "kind": "Service"
            },
            "resource": {
                "group": "",
                "version": "v1",
                "resource": "services"
            },
            "requestKind": {
                "group": "",
                "version": "v1",
                "kind": "Service"
            },
            "requestResource": {
                "group": "",
                "version": "v1",
                "resource": "services"
            },
            "name": "testsvc",
            "operation": "UPDATE",
            "userInfo": {
                "username": "minikube-user",
                "groups": [
                    "system:masters",
                    "system:authenticated"
                ]
            },
            "object": {
                "apiVersion": "v1",
                "kind": "Service",
                "metadata": {
                    "creationTimestamp": "2021-01-05T14:24:26Z",
                    "name": "testsvc",
                    "resourceVersion": "30281949",
                    "selfLink": "/api/v1/namespaces/cnb/services/testsvc",
                    "uid": "fbc8af61-e656-49d2-a996-10360ab6bdd5"
                },
                "spec": {
                    "clusterIP": "172.30.191.161",
                    "externalIPs": externalIPs,
                    "ports": [
                        {
                            "name": "http",
                            "port": 80,
                            "protocol": "TCP",
                            "targetPort": 8080
                        }
                    ],
                    "selector": {
                        "app": "myapp"
                    },
                    "sessionAffinity": "None",
                    "type": "ClusterIP"
                },
                "status": {
                    "loadBalancer": {}
                }
            },
            "oldObject": {
                "apiVersion": "v1",
                "kind": "Service",
                "metadata": {
                    "creationTimestamp": "2021-01-05T14:24:26Z",
                    "name": "testsvc",
                    "resourceVersion": "30281949",
                    "selfLink": "/api/v1/namespaces/cnb/services/testsvc",
                    "uid": "fbc8af61-e656-49d2-a996-10360ab6bdd5"
                },
                "spec": {
                    "clusterIP": "172.30.191.161",
                    "externalIPs": oldExternalIPs,
                    "ports": [
                        {
                            "name": "http",
                            "port": 80,
                            "protocol": "TCP",
                            "targetPort": 8080
                        }
                    ],
                    "selector": {
                        "app": "myapp"
                    },
                    "sessionAffinity": "None",
                    "type": "ClusterIP"
                },
                "status": {
                    "loadBalancer": {}
                }
            },
            "dryRun": false,
            "options": {
                "kind": "CreateOptions",
                "apiVersion": "meta.k8s.io/v1"
            }
        }
    }
}
